input {
    beats {
        port => "5044"
    }
}

filter {
    if [fields][file_type] == "json" {
        json {
            source => "message"
        }
    }
}

output {
    if [fields][file_type] == "json" {
        elasticsearch {
            hosts => [ "elasticsearch01:9200", "elasticsearch02:9200", "elasticsearch03:9200" ]
            index => "logstash-data-%{[@metadata][beat]}"
            document_id => "%{[event_id]}"
            template => "/usr/share/logstash/config/elasticsearch-template-ha.json"
            template_name => "default"
            template_overwrite => "false"
        }
    } else if [fields][file_type] == "log" {
        elasticsearch {
            hosts => [ "elasticsearch01:9200", "elasticsearch02:9200", "elasticsearch03:9200" ]
            index => "logstash-logs-%{[@metadata][beat]}"
            template => "/usr/share/logstash/config/elasticsearch-template-ha.json"
            template_name => "default"
            template_overwrite => "false"
        }
    }
}